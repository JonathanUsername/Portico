<html>

<head>

    <link href='http://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Gabriela' rel='stylesheet' type='text/css'>
    <script type="text/javascript" src="https://rawgithub.com/craftyjs/Crafty/release/dist/crafty-min.js"></script>
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type='text/javascript' src='gamecontroller.js'></script>

</head>

<body>
    <div id="help"><i class="fa fa-question"></i>
    </div>
    <div id="help_info">
        <p>This is a silly project created by Jonathan King</p>
        <p>If you're having technical problems, or the game is running slowly, please try refreshing the page or running it with Google Chrome!</p>
        <p>If you find a bug please show me, but leave some airholes in the box.</p>
    </div>
    <div id="info">
        <h1>Portico</h1>
        <p>A game about walking in Bologna.</p>
    </div>
    <div id="scorediv">
        <div class="scores">
            Current score =
            <span id="score">0</span>
            <br/>High score =
            <span id="high_score">0</span>
        </div>
    </div>
    </div>
    <div id="game">
    </div>


    <script type='text/javascript'>
    // jQuery positioning
    $(function() {
        var score_left = $("#game").offset().left - $("#scorediv").innerWidth() - 5
        $("#scorediv").css("left", String(score_left))
        $("body > canvas").css({
            "height": $("#game").height(),
            "z-index": "1000",
            "left": "0px",
            "bottom": "0px",
            "width": $("#game").width()
        })
    })


    // sizes

    var CANVAS_HEIGHT = window.innerHeight;
    var CANVAS_WIDTH = 500;
    var ROAD_WIDTH = 150;
    var ROAD_X = CANVAS_WIDTH - ROAD_WIDTH
    var SPRITE_SIZE = 32;
    var CAR_SPRITE_SIZE = 62;
    var COLUMN_SIZE = Math.floor((Math.random() * 30) + 30);
    var WALKING_SPAWN_AREA = ROAD_X - COLUMN_SIZE

    // speeds

    var CAR_SPEED = 7;
    var ENEMY_DOWN_SPEED = 5;
    var STATIONARY_SPEED = 3;
    var PLAYER_SPEED = 1.5;
    var ORIGINAL_PLAYER_SPEED = 1.5;
    var ENEMY_UP_SPEED = 1.5;
    var ORIGINAL_CAR_SPEED = 7;
    var ORIGINAL_ENEMY_DOWN_SPEED = 5;
    var ORIGINAL_STATIONARY_SPEED = 3;
    var ORIGINAL_ENEMY_UP_SPEED = 1.5;
    var ENEMY_INTERVAL = 700;
    var COLUMN_INTERVAL = Math.floor((Math.random() * COLUMN_SIZE * 20) + 1000);
    var PICKUP_INTERVAL = Math.floor((Math.random() * 2000) + 1000);
    var FLOOR_INTERVAL = 5000;
    var BRAWL_INTERVAL = 200;
    var APERITIVO_INTERVAL = 4000;
    var POLICE_SPEED = 5;
    var PROTESTER_SPEED = -3;
    var DRUNK_SLOWDOWN = 5;
    var DRUNK_DURATION = 7000;
    var CAFFEINATED_DURATION = 7000;
    var DEATH_DELAY = 1500;

    // points

    var POINTS = {
        "coffee": 2500,
        "beer": 2500,
        "mortadella": 2000,
        "croissant": 1500,
        "pizza": 1000
    }
    var SCORE = 0;
    var LEVEL2_SCORE = 0;
    var HIGH_SCORE = 0;
    var SCORE_THRESHOLD = 50000;
    var DEATHS = 0;
    var DEATHS_BY_CAR = 0;

    // Booleans

    var STARTED = false;
    var PAUSE = false;
    var REACHED_PROTEST = false;
    var APERITIVO = false;
    var END_COMING = false;
    var OUT_OF_PORTICO = false;
    var FOURWAY = false;
    var DRUNK = false;
    var CAFFEINATED = false;
    var PAUSED = false;
    var LEVEL2 = false;
    var ENEMY_HASH = {
        "goliardia": {
            "comp": "goliardia_2",
            "dir": ENEMY_DOWN_SPEED,
            "reel_name": "goliardia_walk",
            "reel1": 200,
            "reel2": 0,
            "reel3": 0,
            "reel4": 3,
            "extra_comp": ", NormalEnemy",
            "reverse": "up_goliardia",
            "multi_type": 0
        },
        "lolif": {
            "comp": "lolif_2",
            "dir": ENEMY_DOWN_SPEED,
            "reel_name": "lolif_walk",
            "reel1": 200,
            "reel2": 0,
            "reel3": 1,
            "reel4": 3,
            "reverse": "up_lolif",
            "extra_comp": ", MultiEnemy",
            "multi_type": "downLolif"
        },
        "punca": {
            "comp": "punca_2",
            "dir": ENEMY_DOWN_SPEED,
            "reel_name": "punca_walk",
            "reel1": 200,
            "reel2": 0,
            "reel3": 2,
            "reel4": 3,
            "reverse": "up_punca",
            "extra_comp": ", MultiEnemy",
            "multi_type": "downDog"
        },
        "suit": {
            "comp": "suit_2",
            "dir": ENEMY_DOWN_SPEED,
            "reel_name": "suit_walk",
            "reel1": 200,
            "reel2": 0,
            "reel3": 3,
            "reel4": 3,
            "reverse": "up_suit",
            "extra_comp": ", NormalEnemy",
            "multi_type": 0
        },
        "up_goliardia": {
            "comp": "up_goliardia_2",
            "dir": ENEMY_UP_SPEED,
            "reel_name": "goliardia_walk",
            "reel1": 200,
            "reel2": 0,
            "reel3": 0,
            "reel4": 3,
            "reverse": "goliardia",
            "extra_comp": ", NormalEnemy",
            "multi_type": 0
        },
        "up_lolif": {
            "comp": "up_lolif_2",
            "dir": ENEMY_UP_SPEED,
            "reel_name": "lolif_walk",
            "reel1": 200,
            "reel2": 0,
            "reel3": 1,
            "reel4": 3,
            "reverse": "lolif",
            "extra_comp": ", MultiEnemy",
            "multi_type": "upLolif"
        },
        "up_punca": {
            "comp": "up_punca_2",
            "dir": ENEMY_UP_SPEED,
            "reel_name": "punca_walk",
            "reel1": 200,
            "reel2": 0,
            "reel3": 2,
            "reel4": 3,
            "reverse": "punca",
            "extra_comp": ", MultiEnemy",
            "multi_type": "upDog"
        },
        "up_suit": {
            "comp": "up_suit_2",
            "dir": ENEMY_UP_SPEED,
            "reel_name": "suit_walk",
            "reel1": 200,
            "reel2": 0,
            "reel3": 3,
            "reel4": 3,
            "reverse": "suit",
            "extra_comp": ", NormalEnemy",
            "multi_type": 0
        },
        "protester": {
            "comp": "up_punca_2",
            "dir": PROTESTER_SPEED,
            "reel_name": "punca_walk",
            "reel1": 200,
            "reel2": 0,
            "reel3": 2,
            "reel4": 3,
            "extra_comp": ", MultiEnemy",
            "multi_type": "upDog"
        },
        "police": {
            "comp": "police2",
            "dir": POLICE_SPEED,
            "reel_name": "police_walk",
            "reel1": 200,
            "reel2": 3,
            "reel3": 3,
            "reel4": 3,
            "extra_comp": ", Police",
            "multi_type": 0
        },
        "fat_police": {
            "comp": "fat_police2",
            "dir": POLICE_SPEED,
            "reel_name": "fat_police_walk",
            "reel1": 200,
            "reel2": 3,
            "reel3": 2,
            "reel4": 3,
            "extra_comp": ", Police",
            "multi_type": 0
        },
        "bald_police": {
            "comp": "bald_police2",
            "dir": POLICE_SPEED,
            "reel_name": "bald_police_walk",
            "reel1": 200,
            "reel2": 3,
            "reel3": 4,
            "reel4": 3,
            "extra_comp": ", Police",
            "multi_type": 0
        },
    }

    var PICKUP_HASH = {
        "mortadella": {
            "extra_comp": "",
            "powerup_effect": "none"
        },
        "pizza": {
            "extra_comp": "",
            "powerup_effect": "none"
        },
        "croissant": {
            "extra_comp": "",
            "powerup_effect": "none"
        },
        "beer": {
            "extra_comp": "Powerup",
            "powerup_effect": "drunk()"
        },
        "coffee": {
            "extra_comp": "Powerup",
            "powerup_effect": "caffeinated()"
        }
    }



    Crafty.init(CANVAS_WIDTH, CANVAS_HEIGHT, document.getElementById('game'));

    Crafty.canvas.init();






    GameController.init({

        
        left: {
            position: {
                left: '22%',
                bottom: '22%'
            },
            dpad: {
                up: {
                    width: '7%',
                    height: '12%',
                    touchStart: function() {
                        Crafty.keydown[Crafty.keys.UP_ARROW] = true;
                    },
                    touchEnd: function() {
                        Crafty.keydown[Crafty.keys.UP_ARROW] = false;
                    }
                },
                down: {
                    width: '7%',
                    height: '12%',
                    touchStart: function() {
                        Crafty.keydown[Crafty.keys.DOWN_ARROW] = true;
                    },
                    touchEnd: function() {
                        Crafty.keydown[Crafty.keys.DOWN_ARROW] = false;
                    }
                },
                left: {
                    width: '12%',
                    height: '7%',
                    touchStart: function() {
                        Crafty.keydown[Crafty.keys.LEFT_ARROW] = true;
                    },
                    touchEnd: function() {
                        Crafty.keydown[Crafty.keys.LEFT_ARROW] = false;
                    }
                },
                right: {
                    width: '12%',
                    height: '7%',
                    touchStart: function() {
                        Crafty.keydown[Crafty.keys.RIGHT_ARROW] = true;
                    },
                    touchEnd: function() {
                        Crafty.keydown[Crafty.keys.RIGHT_ARROW] = false;
                    }
                }
            }
        },

/*
        
        left: {
            position: {
                left: '20%',
                bottom: '22%'
            },
            type: "joystick",
            joystick: {
                radius: 40,
               touchEnd: function(e) {
                    Crafty.keydown[Crafty.keys.UP_ARROW] = false;
                    Crafty.keydown[Crafty.keys.DOWN_ARROW] = false;
                    Crafty.keydown[Crafty.keys.LEFT_ARROW] = false;
                    Crafty.keydown[Crafty.keys.RIGHT_ARROW] = false;
                },
                touchMove: function(e) {
                    if (e.dy > 0) {
                        Crafty.keydown[Crafty.keys.UP_ARROW] = true;
                        Crafty.keydown[Crafty.keys.DOWN_ARROW] = false;
                    } else if (e.dy < 0) {
                        Crafty.keydown[Crafty.keys.UP_ARROW] = false;
                        Crafty.keydown[Crafty.keys.DOWN_ARROW] = true;
                    } else {
                        Crafty.keydown[Crafty.keys.UP_ARROW] = false;
                        Crafty.keydown[Crafty.keys.DOWN_ARROW] = false;
                    }
                    if (e.dx > 0) {
                        Crafty.keydown[Crafty.keys.RIGHT_ARROW] = true;
                        Crafty.keydown[Crafty.keys.LEFT_ARROW] = false;
                    } else if (e.dx < 0) {
                        Crafty.keydown[Crafty.keys.RIGHT_ARROW] = false;
                        Crafty.keydown[Crafty.keys.LEFT_ARROW] = true;
                    } else {
                        Crafty.keydown[Crafty.keys.RIGHT_ARROW] = false;
                        Crafty.keydown[Crafty.keys.LEFT_ARROW] = false;
                    }
                }
            }
        }, */

        right: {
            position: {
                right: '10%',
                bottom: '22%'
            },
            type: 'buttons',
            buttons: [{
                    label: 'start',
                    fontSize: 13,
                    touchStart: function() {
                        if (STARTED == false) {
                            Crafty.trigger("Begin")
                            $("#info").hide();
                            $("#cover_elements").fadeTo(1000, 1, function() {
                                $(this).css({
                                    "visibility": "hidden"
                                });
                            });
                            $("#scorediv").show();
                            STARTED = true;
                        } else {
                            pause();
                        }

                    }
                },
                false, false, false
            ]
        }
    });



    Crafty.scene("loading", function() {
        Crafty.e("2D, DOM, Text")
            .attr({
                x: CANVAS_WIDTH / 2 - 100,
                y: 120
            })
            .text("Loading")
            .textFont({
                family: 'Gabriela',
                size: "35px"
            })
            .textColor('#FFFFFF')
            .css({
                "text-shadow": "2px 2px 2px #000"
            })

        Crafty.load(["mainchar.png", "enemies1.png", "enemies2.png", "cars.png", "pickups.png", "mosaic.jpg", "startroad.jpg", "fighting.png", "table1.png", "table2.png", "pubsign.png"], function() {

            Crafty.sprite(SPRITE_SIZE, "mainchar.png", {
                player_east_1: [0, 0],
                player_east_2: [1, 0],
                player_east_3: [2, 0],
                player_west_1: [0, 1],
                player_west_2: [1, 1],
                player_west_3: [2, 1],
                player_south_1: [0, 2],
                player_south_2: [1, 2],
                player_south_3: [2, 2],
                player_north_1: [0, 3],
                player_north_2: [1, 3],
                player_north_3: [2, 3]
            });

            Crafty.sprite(SPRITE_SIZE, "enemies1.png", {
                goliardia_1: [0, 0],
                goliardia_2: [1, 0],
                goliardia_3: [2, 0],
                lolif_1: [0, 1],
                lolif_2: [1, 1],
                lolif_3: [2, 1],
                punca_1: [0, 2],
                punca_2: [1, 2],
                punca_3: [2, 2],
                suit_1: [0, 3],
                suit_2: [1, 3],
                suit_3: [2, 3]
            });


            Crafty.sprite(SPRITE_SIZE, "enemies2.png", {
                up_goliardia_1: [0, 0],
                up_goliardia_2: [1, 0],
                up_goliardia_3: [2, 0],
                dog_1: [3, 0],
                dog_2: [4, 0],
                dog_3: [5, 0],
                up_lolif_1: [0, 1],
                up_lolif_2: [1, 1],
                up_lolif_3: [2, 1],
                up_dog_1: [3, 1],
                up_dog_2: [4, 1],
                up_dog_3: [5, 1],
                up_punca_1: [0, 2],
                up_punca_2: [1, 2],
                up_punca_3: [2, 2],
                fat_police1: [3, 2],
                fat_police2: [4, 2],
                fat_police3: [5, 2],
                up_suit_1: [0, 3],
                up_suit_2: [1, 3],
                up_suit_3: [2, 3],
                police1: [3, 3],
                police2: [4, 3],
                police3: [5, 3],
                bald_police1: [3, 4],
                bald_police2: [4, 4],
                bald_police3: [5, 4]
            });

            Crafty.sprite(CAR_SPRITE_SIZE, "cars.png", {
                car1: [0, 0],
                car2: [1, 0]
            });

            Crafty.sprite(50, "fighting.png", {
                cloud1: [0, 0],
                cloud2: [1, 0],
                cloud3: [2, 0]
            });

            Crafty.sprite(SPRITE_SIZE, "pickups.png", {
                mortadella: [0, 0],
                croissant: [1, 0],
                pizza: [2, 0],
                beer: [0, 1],
                coffee: [1, 1]
            });


            Crafty.scene("pre-main");
        });
    });

    Crafty.scene("pre-main", function() {
        var ss = '<div id="cover"><div id="cover_elements"><p>You are late for work on the other side of the city. Hurry through the historic porticos of Bologna while catching a bite to eat. Try not to stumble into people, drink too much or get run over, or you will end up delayed and/or dead.</p><p>Movement is controlled by the arrow keys. Press "p" to pause the game at any time.</p></div></div>'
        $("#game").append(ss)
        $("#cover").innerHeight(Crafty(3).y - 60)
        $("#help").click(function() {
            var ohelp = $("#help_info")
            var oleft = $("#scorediv").offset().left
            var otop = $("#scorediv").offset().top + $("#scorediv").innerHeight() + 5
            ohelp.css({
                "left": String(oleft),
                "top": String(otop)
            })
            $("#help_info").slideToggle();
        })
        $("#start_game").click(function() {
            Crafty.trigger("Begin")
            $("#info").hide();
            $("#cover_elements").fadeTo(1000, 1, function() {
                $(this).css({
                    "visibility": "hidden"
                });
            });
            STARTED = true;
        })






        coverroad = Crafty.e("2D, DOM, Color, CoverRoad")
            .attr({
                x: 0,
                y: CANVAS_HEIGHT - 235,
                z: -1,
                w: CANVAS_WIDTH,
                h: 400
            })
            .css({
                "background": "url('coverroad.jpg')",
                "background-size": "535px 250px",
                "background-repeat": "no-repeat"
            })

        bumper = Crafty.e("2D, DOM, Bumper")
            .attr({
                x: CANVAS_WIDTH / 2,
                y: Crafty("CoverRoad").y - SPRITE_SIZE,
                w: SPRITE_SIZE,
                h: SPRITE_SIZE
            })

        arch1 = Crafty.e("2D, DOM, Color, Decoration")
            .attr({
                x: 110,
                y: 60,
                z: -2,
                w: CANVAS_WIDTH / 2,
                h: Crafty("CoverRoad").y - 100
            })
            .color("black")
            .css({
                "width": "50%",
                "padding-top": "57px",
                "padding-bottom": "130px",
                "padding-left": "20px",
                "padding-right": "20px",
                "border-top-left-radius": "140px",
                "border-top-right-radius": "140px"
            }).alpha = 0.7

        arch2 = Crafty.e("2D, DOM, Color, Decoration")
            .attr({
                x: -230,
                y: 60,
                z: -2,
                w: CANVAS_WIDTH / 2,
                h: Crafty("CoverRoad").y - 60
            })
            .color("black")
            .css({
                "width": "50%",
                "padding-top": "57px",
                "padding-bottom": "130px",
                "padding-left": "20px",
                "padding-right": "20px",
                "border-top-left-radius": "140px",
                "border-top-right-radius": "140px"
            }).alpha = 0.7

        arch3 = Crafty.e("2D, DOM, Color, Decoration")
            .attr({
                x: 450,
                y: 60,
                z: -2,
                w: CANVAS_WIDTH / 2,
                h: Crafty("CoverRoad").y - 60
            })
            .color("black")
            .css({
                "width": "50%",
                "padding-top": "57px",
                "padding-bottom": "130px",
                "padding-left": "20px",
                "padding-right": "20px",
                "border-top-left-radius": "140px",
                "border-top-right-radius": "140px"
            }).alpha = 0.7

        coverchar = Crafty.e("2D, DOM, player_north_2, SpriteAnimation, CoverChar, Collision")
            .attr({
                x: CANVAS_WIDTH / 2,
                y: CANVAS_HEIGHT - 60,
                w: SPRITE_SIZE,
                h: SPRITE_SIZE
            })
            .reel("walk_north", 200, 0, 3, 3)
            .animate("walk_north", -1)
            .bind('Begin', function() {
                this.bind("EnterFrame", function() {
                    this.y -= PLAYER_SPEED;
                    if (this.y < Crafty("Bumper").y) {
                        $("#cover").hide();
                        Crafty.scene("main");
                    }
                })
            })
    })


    Crafty.scene("main", function() {
        END_COMING = false;
        END_TIME = false;
        (LEVEL2 == true) ? levelTwo() : levelOne();

        leftwall = Crafty.e('2D, Solid, Canvas, Color, Collision')
            .attr({
                x: 0,
                y: 0,
                w: 10,
                h: CANVAS_HEIGHT
            })
            .color('#9f4b00');
        bottomwall = Crafty.e('2D, Solid, Canvas, Color, Collision, Bottom')
            .attr({
                x: 0,
                y: CANVAS_HEIGHT,
                w: CANVAS_WIDTH,
                h: 1
            })
            .color('#9f4b00');
        topwall = Crafty.e('2D, Solid, Canvas, Color, Collision')
            .attr({
                x: 0,
                y: 0,
                w: CANVAS_WIDTH,
                h: 1
            })
            .color('#9f4b00');
        rightwall = Crafty.e('2D, Solid, Canvas, Color, Collision')
            .attr({
                x: CANVAS_WIDTH,
                y: 0,
                w: 1,
                h: CANVAS_HEIGHT
            })
            .color('#9f4b00');
        road = Crafty.e('2D, Canvas, Color')
            .attr({
                x: ROAD_X + COLUMN_SIZE + 10,
                y: 0,
                w: ROAD_WIDTH,
                h: CANVAS_HEIGHT
            })
            .color('black');

        mainchar = Crafty.e("2D, DOM, player_north_2, SpriteAnimation, Collision, HumanHitbox, MainChar, TileCollision, CustomControls, noClipping")
            .attr({
                x: CANVAS_WIDTH / 2,
                y: CANVAS_HEIGHT - 100,
                x_velocity: 0,
                y_velocity: 0,
                z: 1,
                w: SPRITE_SIZE,
                h: SPRITE_SIZE
            })
            .reel("stand_north", 200, 1, 3, 1)
            .reel("walk_south", 200, 0, 0, 3)
            .reel("walk_west", 200, 0, 1, 3)
            .reel("walk_east", 200, 0, 2, 3)
            .reel("walk_north", 200, 0, 3, 3)
            .CustomControls();

        spawnStart();

        // Hack to fix multiple intervals bug
        try {
            clearAllIntervals();
        } catch (e) {
            console.log("Good luck!")
        }
        startAllIntervals();
        sober();
    });


    Crafty.scene("boss", function() {
        LEVEL2_SCORE = SCORE;
        WALKING_SPAWN_AREA = CANVAS_WIDTH;
        REACHED_PROTEST = true;
        SURVIVAL_TIME = 0
        Crafty.e("2D, DOM, Decoration, BossTime, Text").attr({
            x: 0,
            y: (CANVAS_HEIGHT / 2) - 100,
            h: 50,
            w: 400,
            z: 100
        })
            .one('EnterFrame', function() {
                var self = this;
                window.setTimeout(function() {
                    self.destroy()
                }, 3000)
            })
            .text("Sudden Protest")
            .textFont({
                family: 'Gabriela',
                size: "50px"
            })
            .textColor('#FFFFFF')
            .css({
                "text-shadow": "2px 2px 2px #000"
            })

        timer = Crafty.e("2D, DOM, Decoration, Timer, Text")
            .attr({
                x: 0,
                y: 30,
                w: CANVAS_WIDTH,
                h: 200
            })
            .bind('EnterFrame', function() {
                this.text(parseFloat(SURVIVAL_TIME / 50) + " seconds");
                if (SURVIVAL_TIME >= 0) {
                    SURVIVAL_TIME += 1;
                }
                if (SURVIVAL_TIME > 3000) { // One Minute
                    this.textColor("#00CC00");
                    this.unbind("EnterFrame");
                    clearBossIntervals();
                    Crafty.e("2D, DOM, Decoration, BossTime, Text")
                        .attr({
                            x: CANVAS_WIDTH / 2 - 100,
                            y: CANVAS_HEIGHT / 2 - 100,
                            w: CANVAS_WIDTH,
                            h: 200
                        })
                        .one('EnterFrame', function() {
                            var self = this;
                            window.setTimeout(function() {
                                self.destroy()
                            }, 3000)
                        })
                        .text("Protest Passed")
                        .textFont({
                            family: 'Gabriela',
                            size: "35px"
                        })
                        .textColor('#FFFFFF')
                        .css({
                            "text-shadow": "2px 2px 2px #000"
                        })
                    window.setTimeout(function() {
                        LEVEL2 = true;
                        CAR_SPEED += 3
                        ENEMY_INTERVAL = 500;
                        REACHED_PROTEST = false;
                        Crafty.scene("main")
                    }, 3000)
                }
            })
            .textFont({
                family: 'Gabriela',
                size: "25px"
            })
            .textColor('#FFFFFF')
            .css({
                "text-shadow": "2px 2px 2px #000"
            })

        leftwall = Crafty.e('2D, Solid, Canvas, Color, Collision')
            .attr({
                x: 0,
                y: 0,
                w: 1,
                h: CANVAS_HEIGHT
            })
            .color('#9f4b00');
        bottomwall = Crafty.e('2D, Solid, Canvas, Color, Collision, Bottom')
            .attr({
                x: 0,
                y: CANVAS_HEIGHT,
                w: CANVAS_WIDTH,
                h: 1
            })
            .color('#9f4b00');
        topwall = Crafty.e('2D, Solid, Canvas, Color, Collision')
            .attr({
                x: 0,
                y: 0,
                w: CANVAS_WIDTH,
                h: 1
            })
            .color('#9f4b00');
        rightwall = Crafty.e('2D, Solid, Canvas, Color, Collision')
            .attr({
                x: CANVAS_WIDTH,
                y: 0,
                w: 1,
                h: CANVAS_HEIGHT
            })
            .color('#9f4b00');

        mainchar = Crafty.e("2D, DOM, player_north_2, SpriteAnimation, Collision, HumanHitbox, MainChar, TileCollision, CustomControls, noClipping")
            .attr({
                x: CANVAS_WIDTH / 2,
                y: CANVAS_HEIGHT / 2,
                x_velocity: 0,
                y_velocity: 0,
                w: SPRITE_SIZE,
                h: SPRITE_SIZE
            })
            .reel("stand_north", 200, 1, 3, 1)
            .reel("walk_south", 200, 0, 0, 3)
            .reel("walk_west", 200, 0, 1, 3)
            .reel("walk_east", 200, 0, 2, 3)
            .reel("walk_north", 200, 0, 3, 3)
            .CustomControls();

        try {
            clearAllIntervals();
        } catch (e) {
            console.log("Good luck!")
        }
        bossIntervals();

    })

    function levelTwo() {
        APERITIVO = true;
        clearBossIntervals();
        Crafty.e("2D, DOM, Decoration, Text").attr({
            x: (CANVAS_WIDTH / 2) - 250,
            y: (CANVAS_HEIGHT / 2) - 100,
            h: 50,
            w: 400,
            z: 100
        })
            .one('EnterFrame', function() {
                var self = this;
                window.setTimeout(function() {
                    self.destroy()
                }, 3000)
            })
            .text("Aperitivo")
            .textFont({
                family: 'Gabriela',
                size: "50px"
            })
            .textColor('#FFFFFF')
            .css({
                "text-shadow": "2px 2px 2px #000"
            })
    }

    function levelOne() {
        Crafty.e("2D, DOM, Decoration, BossTime, Text").attr({
            x: 0,
            y: (CANVAS_HEIGHT / 2) - 100,
            h: 50,
            w: 400,
            z: 100
        })
            .one('EnterFrame', function() {
                var self = this;
                window.setTimeout(function() {
                    self.destroy()
                }, 3000)
            })
            .text("Hurry To Work")
            .textFont({
                family: 'Gabriela',
                size: "50px"
            })
            .textColor('#FFFFFF')
            .css({
                "text-shadow": "2px 2px 2px #000"
            })
    }

    function spawnAperitivo() {
        Crafty.e("2D, DOM, OffScreenGone, Decoration")
            .attr({
                x: 10,
                y: -200,
                z: 10,
                dY: STATIONARY_SPEED,
                w: 48,
                h: 41
            })
            .bind('EnterFrame', function() {
                this.y += this.dY;
            })
            .one('EnterFrame', function() {
                var r = Math.floor((Math.random() * 3) + 1)
                makeTable(20, this.y, r, 0)
            })
            .css({
                "background": "url('pubsign.png')",
                "background-size": "cover",
                "background-position": "center"
            })



    }

    function makeTable(x_pos, y_pos, count, counted) {
        var r = Math.floor((Math.random() * 2) + 1);
        var img = {
            1: {
                png: "table2.png",
                w: 94,
                h: 51
            },
            2: {
                png: "table1.png",
                w: 64,
                h: 60
            }
        }
        Crafty.e("2D, DOM, Collision, OffScreenGone, Decoration, Solid, Table")
            .attr({
                x: x_pos,
                y: y_pos + 80,
                dY: STATIONARY_SPEED,
                w: img[r]["w"],
                h: img[r]["h"]
            })
            .bind('EnterFrame', function() {
                this.y += this.dY;
            })
            .css({
                "background": "url('" + img[r]["png"] + "')",
                "background-size": "cover",
                "background-position": "center"
            })
        if (counted < count) {
            counted++;
            makeTable(x_pos + 100, y_pos, count, counted);
        }
    }

    function bossIntervals() {
        police_interval = window.setInterval(function() {
            spawnBrawl();
        }, BRAWL_INTERVAL);
    }

    function clearBossIntervals() {
        window.clearInterval(police_interval)
    }

    function spawnBrawl() {
        var spawn = ["fat_police", "police", "bald_police", "protester", "protester"]
        var r = Math.floor((Math.random() * spawn.length))
        if (spawn[r] == "protester") {
            spawnProtester(spawn[r]);
        } else {
            var rand_x_pos = Math.floor((Math.random() * WALKING_SPAWN_AREA) + 10)
            createEnemy(spawn[r], rand_x_pos, -32);
        }
    }

    function spawnProtester(type) {
        var rand_x_pos = Math.floor((Math.random() * WALKING_SPAWN_AREA) + 10)
        Crafty.e("2D, DOM, " + ENEMY_HASH[type]["comp"] + " , SpriteAnimation, Collision, HumanHitbox, Enemy" + ENEMY_HASH[type]["extra_comp"])
            .attr({
                x: rand_x_pos,
                y: CANVAS_HEIGHT + 32,
                dY: PROTESTER_SPEED,
                w: SPRITE_SIZE,
                multi_type: "upDog",
                h: SPRITE_SIZE
            })
            .reel(ENEMY_HASH[type]["reel_name"], ENEMY_HASH[type]["reel1"], ENEMY_HASH[type]["reel2"], ENEMY_HASH[type]["reel3"], ENEMY_HASH[type]["reel4"])
            .animate(ENEMY_HASH[type]["reel_name"], -1)
            .bind('EnterFrame', function() {
                this.y += this.dY;
                if (this.y < (-32)) {
                    this.destroy()
                }
            })
    }


    function spawnStart() {
        spawnFloor();
        Crafty.e("2D, DOM, Color, Moving, Decoration, OffScreenGone")
            .attr({
                x: 0,
                y: 100,
                z: -1,
                dY: STATIONARY_SPEED,
                w: ROAD_X + COLUMN_SIZE + 10,
                h: CANVAS_HEIGHT
            })
            .bind('EnterFrame', function() {
                this.y += this.dY;
            })
            .css({
                "background": "url('startroad.jpg')",
                "background-size": "400 500",
                "background-position": "center"
            })

        Crafty.e("2D, DOM, Color, Moving, Decoration, OffScreenGone")
            .attr({
                x: 0,
                y: 50,
                z: 10,
                dY: STATIONARY_SPEED,
                w: CANVAS_WIDTH,
                h: 50
            })
            .bind('EnterFrame', function() {
                this.y += this.dY;
                if (this.y > 100) {
                    this.alpha = 0.5;
                }
            })
            .color("#612f02")
    }

    function spawnFloor() {
        Crafty.e("2D, DOM, Color, Floor, Decoration, OffScreenGone")
            .attr({
                x: 10,
                y: -540, //gap of 50
                z: -1,
                dY: STATIONARY_SPEED,
                w: 340,
                h: 490
            })
            .bind('EnterFrame', function() {
                this.y += this.dY;
                if (this.y >= 0 && this.y < 3 && END_COMING == false) {
                    spawnFloor();
                }
            })
            .css({
                "background": "url('mosaic.jpg')",
                "background-size": "contain"
            })
    }

    function spawnEnemy() {
        var spawn = ["car", "punca", "lolif", "goliardia", "suit", "up_punca", "up_lolif", "up_goliardia", "up_suit"]
        var r = Math.floor((Math.random() * spawn.length))
        if (r == 0) {
            spawnCar();
        } else {
            var rand_x_pos = Math.floor((Math.random() * WALKING_SPAWN_AREA) + 10)
            createEnemy(spawn[r], rand_x_pos, -32);

        }
    }

    function createEnemy(type, x_pos, y_pos, noOther) {
        Crafty.e("2D, DOM, " + ENEMY_HASH[type]["comp"] + " , SpriteAnimation, Collision, HumanHitbox, OffScreenGone, Enemy" + ENEMY_HASH[type]["extra_comp"])
            .attr({
                x: x_pos,
                y: y_pos,
                dY: ENEMY_HASH[type]["dir"],
                w: SPRITE_SIZE,
                no_other: noOther,
                multi_type: ENEMY_HASH[type]["multi_type"],
                h: SPRITE_SIZE
            })
            .reel(ENEMY_HASH[type]["reel_name"], ENEMY_HASH[type]["reel1"], ENEMY_HASH[type]["reel2"], ENEMY_HASH[type]["reel3"], ENEMY_HASH[type]["reel4"])
            .animate(ENEMY_HASH[type]["reel_name"], -1)
            .bind('EnterFrame', function() {
                this.y += this.dY;
            })
    }

    function spawnCar() {
        var rand_x_pos = Math.floor((Math.random() * 50) + (ROAD_X + COLUMN_SIZE))
        Crafty.e("2D, DOM, Car, SpriteAnimation, Collision, OffScreenGone")
            .attr({
                x: rand_x_pos,
                y: -64,
                dY: CAR_SPEED,
                w: CAR_SPRITE_SIZE,
                z: 6,
                h: CAR_SPRITE_SIZE
            })
            .bind('EnterFrame', function() {
                this.y += this.dY;
            })
    }


    function spawnColumn() {
        Crafty.e("2D, DOM, Collision, Column, Solid, Color, OffScreenGone")
            .attr({
                x: ROAD_X,
                y: -100,
                z: 10,
                dY: STATIONARY_SPEED,
                w: COLUMN_SIZE,
                h: COLUMN_SIZE
            })
            .bind('EnterFrame', function() {
                this.y += this.dY;
            })
            .color("#9f4b00")

    }


    function spawnPickup() {
        var spawn = ["mortadella", "croissant", "pizza", "beer", "coffee"]
        var r = Math.floor((Math.random() * spawn.length))
        createPickup(spawn[r]);
    }


    function createPickup(type) {
        var rand_x_pos = Math.floor((Math.random() * (WALKING_SPAWN_AREA - ROAD_WIDTH)) + 10)
        Crafty.e("2D, DOM, " + type + ", Collision, Pickup," + PICKUP_HASH[type]["extra_comp"])
            .attr({
                x: rand_x_pos,
                y: -32,
                dY: STATIONARY_SPEED,
                w: SPRITE_SIZE,
                pickup: type,
                powerup_effect: PICKUP_HASH[type]["powerup_effect"],
                h: SPRITE_SIZE
            })
    }


    Crafty.c("Powerup", {
        init: function() {
            this.bind('EnterFrame', function() {
                if (this.hit('MainChar')) {
                    eval(this.powerup_effect);
                }
            })
        }
    })

    Crafty.c("Pickup", {
        init: function() {
            this.requires("OffScreenGone")
            this.bind('EnterFrame', function() {
                this.y += this.dY;
                if (this.hit('MainChar')) {
                    scoreUp(this.pickup);
                    this.destroy()
                }
            })
        }
    })

    function caffeinated() {
        CAFFEINATED = true;
        FOURWAY = true;
        PLAYER_SPEED = 3;
        window.setTimeout(function() {
            if (CAFFEINATED == true) {
                sober();
            }
        }, CAFFEINATED_DURATION)
    }

    function drunk() {
        if (DRUNK == false) {
            DRUNK = true;
            FOURWAY = true;
            var arr = Crafty("Pickup, Column, Car, Enemy, Decoration")
            ENEMY_DOWN_SPEED = ENEMY_DOWN_SPEED / DRUNK_SLOWDOWN
            ENEMY_UP_SPEED = ENEMY_UP_SPEED / DRUNK_SLOWDOWN
            CAR_SPEED = CAR_SPEED / DRUNK_SLOWDOWN
            STATIONARY_SPEED = STATIONARY_SPEED / DRUNK_SLOWDOWN
            clearAllIntervals();
            for (i = 0; i < arr.length; i++) {
                Crafty(arr[i]).dY = Crafty(arr[i]).dY / DRUNK_SLOWDOWN
            }
            window.setTimeout(function() {
                if (DRUNK == true) {
                    sober();
                }
            }, DRUNK_DURATION)
        }
    }

    function sober() {
        if (DRUNK == true) {
            var arr = Crafty("Pickup, Column, Car, Enemy, Decoration")
            for (i = 0; i < arr.length; i++) {
                Crafty(arr[i]).dY = Crafty(arr[i]).dY * DRUNK_SLOWDOWN
            }
            ENEMY_DOWN_SPEED = ENEMY_DOWN_SPEED * DRUNK_SLOWDOWN
            ENEMY_UP_SPEED = ENEMY_UP_SPEED * DRUNK_SLOWDOWN
            CAR_SPEED = CAR_SPEED * DRUNK_SLOWDOWN
            STATIONARY_SPEED = STATIONARY_SPEED * DRUNK_SLOWDOWN
            clearAllIntervals();
            startAllIntervals();
            DRUNK = false;
        }
        FOURWAY = false;
        PLAYER_SPEED = ORIGINAL_PLAYER_SPEED;
        CAFFEINATED = false;
    }

    function spawnEnd() {
        REACHED_PROTEST = true;
        Crafty.e("2D, DOM, Color, End, Collision, Moving, Decoration")
            .attr({
                x: 0,
                y: -50,
                z: 5,
                dY: STATIONARY_SPEED,
                w: CANVAS_WIDTH,
                h: 50
            })
            .bind('EnterFrame', function() {
                this.y += this.dY;
                if (this.y > 0) {
                    road.y += this.dY;
                    this.alpha = 0.5;
                }
                if (this.y > CANVAS_HEIGHT) {
                    OUT_OF_PORTICO = true;
                    spawnBoss();
                    road.destroy();
                    this.destroy();
                }
            })
            .color("#612f02")
    }

    function spawnBoss() {
        console.log("boss time")
        setTimeout(function() {
            Crafty.scene("boss");
        }, 1000)
    }


    function scoreUp(obj) {
        SCORE = SCORE + POINTS[obj];
        document.getElementById("score").innerHTML = SCORE;
    }

    function restart() {
        if (HIGH_SCORE < SCORE) {
            HIGH_SCORE = SCORE
        }
        document.getElementById("high_score").innerHTML = HIGH_SCORE;
        document.getElementById("score").innerHTML = 0;
        SCORE = LEVEL2_SCORE;
        Crafty.e("2D, DOM, Decoration, Text").attr({
            x: (CANVAS_WIDTH / 2) - 50,
            y: (CANVAS_HEIGHT / 2) - 100,
            h: 50,
            w: 200,
            z: 100
        })
            .one('EnterFrame', function() {
                var self = this;
                window.setTimeout(function() {
                    self.destroy()
                }, 3000)
            })
            .text("LATE")
            .textFont({
                family: 'Gabriela',
                size: "50px"
            })
            .textColor('#FFFFFF')
            .css({
                "text-shadow": "2px 2px 2px #000"
            })
        REACHED_PROTEST == false ? clearAllIntervals() : clearBossIntervals()
        if (DRUNK == true || CAFFEINATED == true) {
            sober();
        }
        setTimeout(function() {
            if (LEVEL2 == false) {
                REACHED_PROTEST == false ? Crafty.scene("main") : Crafty.scene("boss");
            } else {
                Crafty.scene("main")
            }
        }, 2000)

    }



    function pause() {
        if (PAUSED == false) {
            REACHED_PROTEST == false ? clearAllIntervals() : clearBossIntervals()
            $("#pause_game").show();
            PAUSED = true;
            Crafty.pause();
        } else {
            $("#pause_game").hide();
            Crafty.pause();
            if (REACHED_PROTEST == false) {
                clearAllIntervals();
                startAllIntervals();
            } else {
                clearBossIntervals();
                bossIntervals();
            }
        }
    }



    Crafty.c("MultiEnemy", {
        init: function() {
            this.one('EnterFrame', function() {
                if (Math.random() > 0.7 && this.no_other != true) {
                    this.withOther(this.multi_type, this);
                }
                if (Math.random() > 0.9 && this.no_other != true) {
                    this.withOther(this.multi_type, this);
                }
            })
        }
    })

    Crafty.c("Enemy", {
        init: function() {
            this._z = 9;
            var this_enemy = this;
            this.bind("EnterFrame", function() {
                if (this.hit('Enemy') && REACHED_PROTEST == false) {
                    Math.random() < 0.5 ? this.x += 10 : this.x -= 10;
                }
                if (this.hit('Column')) {
                    this.x -= 10;
                }
                if (this.hit('Car')) {
                    var carobj = this.hit('Car')[0].obj
                    console.log(carobj)
                    wheelStreak(carobj.x + 7, carobj.y + SPRITE_SIZE);
                    wheelStreak(carobj.x + 50, carobj.y + SPRITE_SIZE);
                    this.dead();
                }
                if (this.hit('Table')) {
                    this_enemy.unbind("EnterFrame");
                    var new_y = this_enemy.y;
                    (this_enemy.y >= this.hit('Table')[0].obj.y) ? new_y += 10 : new_y -= 10;
                    this_enemy.destroy();
                    for (var i in ENEMY_HASH) {
                        if (this_enemy.has(ENEMY_HASH[i]["comp"])) {
                            createEnemy(ENEMY_HASH[i]["reverse"], this_enemy.x, new_y, true)
                            return true;
                        }
                    }
                }
            })
        },
        withOther: function(dir, orig) {
            anim = {
                "upDog": {
                    "name": "up_dog_walk",
                    "val1": 200,
                    "val2": 3,
                    "val3": 1,
                    "val4": 3,
                    "speed": ENEMY_UP_SPEED,
                    "sprite": "up_dog_2"
                },
                "downDog": {
                    "name": "dog_walk",
                    "val1": 200,
                    "val2": 3,
                    "val3": 0,
                    "val4": 3,
                    "speed": ENEMY_DOWN_SPEED,
                    "sprite": "dog_2"
                },
                "upLolif": {
                    "name": "lolif_walk",
                    "val1": 200,
                    "val2": 0,
                    "val3": 1,
                    "val4": 3,
                    "speed": ENEMY_UP_SPEED,
                    "sprite": "up_lolif_2"
                },
                "downLolif": {
                    "name": "lolif_walk",
                    "val1": 200,
                    "val2": 0,
                    "val3": 1,
                    "val4": 3,
                    "speed": ENEMY_DOWN_SPEED,
                    "sprite": "lolif_2"
                }
            };
            Crafty.e("2D, DOM," + anim[dir]["sprite"] + ", SpriteAnimation, Collision, HumanHitbox, Enemy")
                .attr({
                    x: (REACHED_PROTEST == false) ? orig.x + 10 : orig.x - 20,
                    y: orig.y,
                    w: SPRITE_SIZE,
                    h: SPRITE_SIZE
                })
                .reel(anim[dir]["name"], anim[dir]["val1"], anim[dir]["val2"], anim[dir]["val3"], anim[dir]["val4"])
                .animate(anim[dir]["name"], -1)
                .bind('EnterFrame', function() {
                    this.y = orig.y;
                    if (this.hit('up_dog_2') && REACHED_PROTEST == true) {
                        Math.random() < 0.5 ? this.x += 40 : this.x -= 20;
                    }
                    if (this.y > CANVAS_HEIGHT && REACHED_PROTEST == false) {
                        this.destroy()
                    }
                    if (this.y < 0 && REACHED_PROTEST == true) {
                        this.destroy()
                    }
                })
        },
        dead: function() {
            this.destroy();
        }
    });

    Crafty.c("Car", {
        init: function() {
            var cars = ["car1", "car2"];
            var r = Math.floor((Math.random() * cars.length));
            this.requires("Collision, OffScreenGone");
            this.addComponent(cars[r]);
            this.bind('EnterFrame', function() {
                var carx = this.x;
                var cary = this.y
                if (this.hit("MainChar")) {
                    wheelStreak(this.x + 7, this.y + SPRITE_SIZE);
                    wheelStreak(this.x + 50, this.y + SPRITE_SIZE);
                    DEATHS_BY_CAR++;
                }
            })
        }
    });

    Crafty.c("HumanHitbox", {
        init: function() {
            this.collision(
                new Crafty.polygon([4, 3], [8, 31], [24, 31], [28, 3])
            )
        }
    });

    Crafty.c("Police", {
        init: function() {
            this.bind('EnterFrame', function() {
                if (this.hit('Enemy')) {
                    var other = this.hit("Enemy")
                    fightCloud(this);
                    fightCloud(other[0].obj);
                    other[0].obj.destroy();
                    this.destroy();
                }
            })
        }
    });

    Crafty.c("Corpse", {
        init: function() {
            this.requires("OffScreenGone")
            this.bind('EnterFrame', function() {
                this.y += STATIONARY_SPEED;
            })
        }
    });

    Crafty.c("OffScreenGone", {
        init: function() {
            this.bind('EnterFrame', function() {
                if (this.y > CANVAS_HEIGHT) {
                    this.destroy()
                }
            })
        }
    });



    Crafty.c("CustomControls", {
        CustomControls: function() {
            this.bind("EnterFrame", function(old) {
                var up = Crafty.keydown[Crafty.keys.UP_ARROW];
                var down = Crafty.keydown[Crafty.keys.DOWN_ARROW];
                var left = Crafty.keydown[Crafty.keys.LEFT_ARROW];
                var right = Crafty.keydown[Crafty.keys.RIGHT_ARROW];
                var p_key = Crafty.keydown[Crafty.keys.P];
                if (up) {
                    this.y_velocity = -2 * PLAYER_SPEED;
                    if (!this.isPlaying("walk_north")) {
                        this.animate("walk_north", -1);
                    }
                }
                if (down) {
                    this.y_velocity = 2 * PLAYER_SPEED;
                    if (FOURWAY == true && !this.isPlaying("walk_south") && !left && !right) {
                        this.animate("walk_south", -1)
                    } else if (FOURWAY == false && !this.isPlaying("walk_south") && !left && !right) {
                        this.animate("stand_north", -1);
                    }
                }
                if ((left && !up) || (left && down)) {
                    this.x_velocity = -2 * PLAYER_SPEED;
                    if (!this.isPlaying("walk_west")) {
                        this.animate("walk_west", -1);
                    }
                }
                if ((right && !up) || (right && down)) {
                    this.x_velocity = 2 * PLAYER_SPEED;
                    if (!this.isPlaying("walk_east")) {
                        this.animate("walk_east", -1);
                    }
                }
                if (left && up) {
                    this.x_velocity = -2 * PLAYER_SPEED;
                    if (!this.isPlaying("walk_north")) {
                        this.animate("walk_north", -1);
                    }
                }
                if (right && up) {
                    this.x_velocity = 2 * PLAYER_SPEED;
                    if (!this.isPlaying("walk_north")) {
                        this.animate("walk_north", -1);
                    }
                }
                if (!left && !right) {
                    this.x_velocity = 0;
                    if (!this.isPlaying("walk_north") && FOURWAY == false) {
                        this.animate("walk_north", -1);
                    }
                }
                if (!up && !down) {
                    this.y_velocity = 0;
                }
                if (p_key) {
                    pause();
                    Crafty.pause();
                }
                this.x += this.x_velocity;
                this.y += this.y_velocity;
                if (this.hit('Solid')) {
                    if (up || down) {
                        this.y -= this.y_velocity
                    }
                    if (left || right) {
                        this.x -= this.x_velocity
                    }
                }
                if (this.hit('Column') && (this.x < ROAD_X || this.x > (ROAD_X + COLUMN_SIZE - 5))) {
                    if (left || right) {
                        this.x -= this.x_velocity
                    }
                }
                if (this.hit('Solid') && (this.x < this.hit('Solid')[0].obj.x || this.x > (this.hit('Solid')[0].obj.x + this.hit('Solid')[0].obj.w))) {
                    if (left || right) {
                        this.x -= this.x_velocity
                    }
                }
                if (this.hit('Enemy')) {
                    var other = this.hit("Enemy")
                    DEATHS++;
                    fightCloud(this);
                    fightCloud(other[0].obj);
                    other[0].obj.destroy();
                    this.unbind("EnterFrame");
                    window.setTimeout(function() {
                        restart();
                    }, DEATH_DELAY);
                }
                if (this.hit('Car')) {
                    this.unbind("EnterFrame");
                    this.addComponent("Corpse");
                    window.setTimeout(function() {
                        restart();
                    }, DEATH_DELAY);
                }
                if (this.hit('Column') && !this.hit('Bottom')) {
                    this.y += 10;
                }
                if (this.hit('Column') && this.hit('Bottom')) {
                    this.destroy();
                    restart();
                }
                if (this.hit('Table') && !this.hit('Bottom')) {
                    this.y += 10;
                }
                if (this.hit('Table') && this.hit('Bottom')) {
                    this.destroy();
                    restart();
                }
                if (SCORE > SCORE_THRESHOLD && END_COMING == false) {
                    END_COMING = true;
                    clearAllIntervals();
                    window.setTimeout(spawnEnd, 5000)
                }
            });
        }
    });


    function fightCloud(self) {
        Crafty.e('2D, DOM, cloud2, Decoration, SpriteAnimation, Collision, HumanHitbox, Enemy, Cloud, OffScreenGone')
            .attr({
                x: self.x - (SPRITE_SIZE / 2),
                y: self.y - (SPRITE_SIZE / 2),
                w: 50,
                z: 50,
                h: 50
            })
            .reel("fight_cloud", 200, 0, 0, 3)
            .animate("fight_cloud", -1)
            .bind("EnterFrame", function() {
                self.unbind("EnterFrame");
                self.y += this.y
                this.y += STATIONARY_SPEED;
            })
    }

    function wheelStreak(wheelx, wheely) {
        Crafty.e('2D, DOM, Color, Decoration, OffScreenGone')
            .attr({
                x: wheelx,
                y: wheely,
                w: 5,
                z: 0,
                h: 0
            })
            .bind("EnterFrame", function() {
                this.y += STATIONARY_SPEED;
                this.h += CAR_SPEED - STATIONARY_SPEED;
            })
            .color("#CC0000")
    }

    function startAllIntervals() {
        enemy_interval = window.setInterval(function() {
            spawnEnemy();
        }, ENEMY_INTERVAL);

        column_interval = window.setInterval(function() {
            spawnColumn();
        }, COLUMN_INTERVAL);

        pickup_interval = window.setInterval(function() {
            spawnPickup();
        }, PICKUP_INTERVAL);
        if (APERITIVO == true) {
            aperitivo_interval = window.setInterval(function() {
                spawnAperitivo();
            }, APERITIVO_INTERVAL);
        }
    }

    function clearAllIntervals() {
        window.clearInterval(enemy_interval)
        window.clearInterval(column_interval)
        window.clearInterval(pickup_interval)
        try {
            window.clearInterval(aperitivo_interval)();
        } catch (e) {
            console.log("No aperitivo yet")
        }

        //       window.clearInterval(floor_interval)
    }





    Crafty.scene("loading");
    </script>
    <style>
    .controlsCanvas {
        position: absolute;
        z-index: 100;
        left: 0px;
        bottom: 0px;
        width: 100%;
    }
    #info {
        text-align: center;
        padding: 0;
        background-color: rgba(100, 100, 100, 0.3);
        width: 100%;
        z-index: 100;
        position: absolute;
        right: 0;
    }
    body {
        height: 700px;
        width: 500px;
        background-color: #462203;
        margin: 0;
    }
    h1 {
        margin-bottom: -10px;
        font-family: Gabriela;
        margin-top: 0px;
    }
    div#pause_game {
        padding: 22px;
        z-index: 1000;
        position: absolute;
        left: 24%;
        top: 35%;
        display: none;
    }
    #help_info {
        display: none;
        width: 200px;
        text-align: center;
        position: absolute;
        top: 300;
        background-color: rgb(51, 51, 51);
        padding: 5px;
        left: 300;
        font-size: 13px;
    }
    #help {
        display: none;
        font-size: 20px;
        cursor: pointer;
        color: white;
        background-color: #298ee8;
        padding: 5px;
        position: fixed;
        top: 0;
        left: 0;
    }
    #start_game,
    #pause_game {
        margin: 0 auto;
        text-align: center;
        cursor: pointer;
        background-color: #298ee8;
        padding: 5px;
        font-family: Gabriela;
        color: white;
        font-size: 30px;
    }
    #cover {
        text-align: center;
        position: absolute;
        top: 60px;
        width: 50%;
        left: 22%;
        padding-top: 57px;
        padding-bottom: 130px;
        padding-left: 20px;
        padding-right: 20px;
        border-top-left-radius: 140px;
        border-top-right-radius: 140px;
        z-index: 100;
        font-size: 13px;
    }
    p,
    #scorediv {
        font-family: Montserrat;
        padding-bottom: 7;
    }
    p {
        font-family: Montserrat;
        color: white;
        text-shadow: 1px 1px 1px #222;
        margin-bottom: 5px;
    }
    #game {
        background-color: #e88329;
        margin: 0 auto;
        position: relative;
    }
    #info,
    #scorediv {
        color: white;
        text-shadow: 1px 1px 1px #222;
    }
    #scorediv > * {
        vertical-align: middle;
    }
    div#scorediv {
        background-color: rgba(100, 100, 100, 0.5);
        width: 200px;
        padding: 5px;
        position: absolute;
        z-index: 1000;
        right: 0;
        left: 275px !important;
        display: none;
    }
    div.coffee {
        width: 32px;
        height: 32px;
        background: url(pickups.png);
        background-position: -32px -32px;
        display: inline-block;
    }
    div.beer {
        width: 32px;
        height: 32px;
        background: url(pickups.png);
        background-position: 0 -32px;
        display: inline-block;
    }
    div.mortadella {
        width: 32px;
        height: 32px;
        background: url(pickups.png);
        background-position: 0 0;
        display: inline-block;
    }
    div.croissant {
        width: 32px;
        height: 32px;
        background: url(pickups.png);
        background-position: 32px 0;
        display: inline-block;
    }
    div.pizza {
        width: 32px;
        height: 32px;
        background: url(pickups.png);
        background-position: 64px 0;
        display: inline-block;
    }
    div#scorediv img {
        vertical-align: middle;
        margin: 7px;
    }
    div#scorediv {
        text-align: left;
    }
    div.scores {
        margin-left: 5px;
    }
    </style>
</body>

</html>
